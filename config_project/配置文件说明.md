# 配置文件说明

## 概述

本模块的配置管理通过 `global_setting/global_dic.py` 模块实现。该模块会读取配置文件并生成路径字典供其他模块使用。

## 必需的配置文件

### 1. 数据路径配置文件

**文件位置**：需要根据 `global_dic.py` 中的逻辑确定
**文件名**：`data_update_path_config.xlsx`

**作用**：配置所有数据文件的输入输出路径

**格式**：Excel文件，包含两个工作表

#### Sheet 1: main_folder
主文件夹配置

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| folder_type | 文本 | 文件夹类型标识 | factor |
| path | 文本 | 主文件夹路径 | D:\Data |

#### Sheet 2: sub_folder
子文件夹配置

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| data_type | 文本 | 数据类型标识（用于代码中调用） | output_factor_exposure |
| folder_type | 文本 | 关联的主文件夹类型 | factor |
| folder_name | 文本 | 子文件夹名称 | factorExposure |
| MPON | 数值 | 是否使用项目相对路径（1表示是） | 1 |
| RON | 数值 | 是否使用磁盘根路径（1表示是） | 0 |

**路径生成规则**：
- `MPON=1`：路径 = 项目根目录 + path + folder_name
- `RON=1`：路径 = 磁盘根目录 + path + folder_name
- `RON='config'`：路径 = config目录 + path + folder_name

**必需的 data_type 配置**：

```
# 因子数据输出路径
output_factor_exposure       # 因子暴露度输出目录
output_factor_return         # 因子收益率输出目录
output_factor_stockpool      # 因子股票池输出目录
output_factor_cov            # 因子协方差输出目录
output_factor_specific_risk  # 因子特异性风险输出目录
output_indexexposure         # 指数暴露度输出目录
output_indexexposure_yg      # 指数YG因子暴露度输出目录
output_timeseries            # 时间序列数据输出目录

# 因子数据输入路径
input_factor_jy              # 聚源因子数据输入目录
input_factor_jy_old          # 聚源因子数据（旧版）输入目录
input_factor_wind            # Wind因子数据输入目录
input_factor_cov_jy          # 聚源协方差数据输入目录
input_factor_cov_wind        # Wind协方差数据输入目录
input_factor_specific_jy     # 聚源特异性风险输入目录
input_factor_specific_wind   # Wind特异性风险输入目录

# 其他配置
data_source_priority         # 数据源优先级配置文件路径
config_sql                   # SQL配置文件路径
time_tools_config            # 时间工具配置文件路径
output_indexcomponent        # 指数成分股数据目录
data_other                   # 其他数据目录（股票池等）
```

### 2. 数据源优先级配置

**文件路径**：由 `data_source_priority` 配置项指定
**文件格式**：Excel (.xlsx)

**作用**：配置不同数据类型使用哪个数据源以及优先级顺序

**格式**：

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| data_type | 文本 | 数据类型 | factor |
| source_name | 文本 | 数据源名称 | jy 或 wind |
| rank | 数值 | 优先级（数值越小优先级越高） | 1 |

**Sheet名称**：`factor`（用于因子数据）

**示例**：
```
data_type  | source_name | rank
-----------|-------------|------
factor     | jy          | 1
factor     | wind        | 2
```

### 3. SQL数据库连接配置

**文件路径**：由 `config_sql` 配置项指定，或使用默认路径 `config_project/Data_update/sql_connection.yaml`
**文件格式**：YAML

**作用**：配置MySQL数据库连接信息

**格式示例**：
```yaml
database:
  host: localhost
  port: 3306
  user: your_username
  password: your_password
  database: factor_data
```

**参考文件**：`sql_connection.yaml.example`

### 4. 时间工具配置

**文件路径**：由 `time_tools_config` 配置项指定
**文件格式**：Excel (.xlsx)

**作用**：配置数据更新的时间策略

**包含工作表**：

#### Sheet 1: time_zoon
时间区间配置（用于区分不同的更新时间段）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| zoom_name | 文本 | 时间区间名称 | morning |
| start_time | 时间 | 开始时间 | 08:00 |
| end_time | 时间 | 结束时间 | 12:00 |

#### Sheet 2: critical_time
关键时间点配置

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| zoom_name | 文本 | 配置标识 | time_1, time_2, time_3 |
| critical_time | 时间 | 关键时间点 | 17:00 |

**必需的 zoom_name**：
- `time_1`：评分数据更新的关键时间
- `time_2`：市场数据更新的关键时间
- `time_3`：因子数据更新的关键时间

### 5. 其他数据文件

#### 股票池文件
**路径**：`data_other` 配置项下
**文件**：
- `StockUniverse_new.csv` - 新版股票池
- `StockUniverse.csv` - 旧版股票池

**格式**：
```csv
S_INFO_WINDCODE,...
000001.SZ,...
000002.SZ,...
```

#### 指数成分股文件
**路径**：`output_indexcomponent` 配置项下
**子目录**：
- `hs300/` - 沪深300成分股
- `zz500/` - 中证500成分股
- `zz1000/` - 中证1000成分股
- `zz2000/` - 中证2000成分股
- `zzA500/` - 中证A500成分股
- `gz2000/` - 国证2000成分股
- `sz50/` - 上证50成分股

**文件格式**：CSV文件，包含code、weight、status字段

## 配置文件创建步骤

### 步骤1：创建数据目录结构

根据你的实际情况创建数据存储目录，例如：

```
D:\FactorData\
├── input\
│   ├── jy\               # 聚源数据
│   ├── wind\             # Wind数据
│   ├── cov_jy\           # 聚源协方差
│   ├── cov_wind\         # Wind协方差
│   ├── specific_jy\      # 聚源特异性风险
│   └── specific_wind\    # Wind特异性风险
├── output\
│   ├── factorExposure\   # 因子暴露度
│   ├── factorReturn\     # 因子收益率
│   ├── factorPool\       # 因子股票池
│   ├── factorCov\        # 因子协方差
│   ├── factorSpecificRisk\  # 特异性风险
│   ├── indexExposure\    # 指数暴露度
│   └── timeseries\       # 时间序列
└── config\
    ├── data_source_priority.xlsx
    ├── time_tools_config.xlsx
    └── other_data\
        ├── StockUniverse_new.csv
        └── StockUniverse.csv
```

### 步骤2：创建 data_update_path_config.xlsx

使用Excel创建配置文件，参考上述格式填写路径信息。

### 步骤3：创建其他配置文件

- 复制 `sql_connection.yaml.example` 为 `sql_connection.yaml` 并填入数据库信息
- 创建数据源优先级配置文件
- 创建时间工具配置文件

### 步骤4：验证配置

运行以下Python代码测试配置是否正确：

```python
import global_setting.global_dic as glv

# 测试路径配置
print("因子暴露度输出路径:", glv.get('output_factor_exposure'))
print("SQL配置路径:", glv.get('config_sql'))
print("时间工具配置:", glv.get('time_tools_config'))
```

## 常见问题

**Q: 找不到配置文件？**
A: 检查 `global_dic.py` 中的 `config_path_finding()` 函数逻辑，确保配置文件在正确的目录层级。

**Q: 路径配置不生效？**
A: 检查 `data_update_path_config.xlsx` 中的 MPON 和 RON 设置是否正确。

**Q: 数据源切换不工作？**
A: 检查数据源优先级配置文件中的 rank 字段，确保数值正确。
