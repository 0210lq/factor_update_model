# 数据需求清单

本文档列出了 factor_update_model 项目运行所需的所有数据文件及其格式。

## 一、输入数据文件

### 1. 因子原始数据 (.mat 文件)

**路径配置项**: `input_factor_jy`, `input_factor_jy_old`, `input_factor_wind`

**文件命名**: `LNMODELACTIVE-YYYYMMDD.mat`

**内部结构** (MATLAB格式):
```
lnmodel_active_daily
├── factorexposure    # 因子暴露度矩阵 [N_stocks x N_factors]
└── factorret         # 因子收益率矩阵 [1 x N_factors]
```

**因子列 (共40个)**:

| 类别 | 因子名称 |
|------|----------|
| Barra因子 (10个) | country, size, beta, momentum, resvola, nlsize, btop, liquidity, earningsyield, growth |
| 行业因子 (30个) | 石油石化, 煤炭, 有色金属, 电力及公用事业, 钢铁, 基础化工, 建筑, 建材, 轻工制造, 机械, 电力设备及新能源, 国防军工, 汽车, 商贸零售, 消费者服务, 家电, 纺织服装, 医药, 食品饮料, 农林牧渔, 银行, 非银行金融, 房地产, 综合金融, 交通运输, 电子, 通信, 计算机, 传媒, 综合 |

**股票数量**: 约 5651 只

---

### 2. 协方差矩阵数据 (.csv 文件)

**路径配置项**: `input_factor_cov_jy`, `input_factor_cov_wind`

**文件命名**: 包含日期 `YYYYMMDD` 的 CSV 文件

**格式**:
- 行数: 40 (因子数)
- 列数: 41 (Observations列 + 40个因子列)
- 首列: `Observations`
- 数据: 因子协方差矩阵

**示例结构**:
```csv
Observations,country,size,beta,...,综合
1,0.0001,0.00005,0.00003,...,0.00001
2,0.00005,0.0002,0.00004,...,0.00002
...
```

---

### 3. 特异性风险数据 (.csv 文件)

**路径配置项**: `input_factor_specific_jy`, `input_factor_specific_wind`

**文件命名**: 包含日期 `YYYYMMDD` 的 CSV 文件，文件名长度为 31 字符

**格式**:
- 行数: 1
- 列数: 5651 (股票数量)
- 数据: 每只股票的特异性风险值

**示例结构**:
```csv
(无列名，直接是数值)
0.023,0.018,0.025,...
```

---

### 4. 股票池数据 (.csv 文件)

**路径配置项**: `data_other`

**文件名**:
- `StockUniverse_new.csv` (新版，5651只股票)
- `StockUniverse.csv` (旧版)

**格式**:
```csv
S_INFO_WINDCODE,type,S_INFO_LISTDATE,S_INFO_DELISTDATE
000001.SZ,stockuni_new,19910403,
000002.SZ,stockuni_new,19910129,
...
```

| 字段名 | 类型 | 说明 |
|--------|------|------|
| S_INFO_WINDCODE | string | Wind股票代码 (如 000001.SZ) |
| type | string | 股票池类型 |
| S_INFO_LISTDATE | float | 上市日期 YYYYMMDD |
| S_INFO_DELISTDATE | float | 退市日期 (可为空) |

---

### 5. 指数成分股数据

**路径配置项**: `output_indexcomponent`

**目录结构**:
```
output_indexcomponent/
├── sz50/      # 上证50
├── hs300/     # 沪深300
├── zz500/     # 中证500
├── zz1000/    # 中证1000
├── zz2000/    # 中证2000
├── zzA500/    # 中证A500
└── gz2000/    # 国证2000
```

**文件命名**: 包含日期的 CSV 文件

**格式**:
```csv
code,weight,status
000001.SZ,0.0015,1
000002.SZ,0.0023,1
...
```

| 字段名 | 类型 | 说明 |
|--------|------|------|
| code | string | 股票代码 |
| weight | float | 权重 (0-1之间，总和为1) |
| status | int | 状态 (1=有效) |

---

## 二、配置文件

### 1. 数据路径配置

**文件**: `config_path/data_update_path_config.xlsx`

**Sheet: main_folder**
```
| folder_type | path |
|-------------|------|
| factor | D:\Data_prepared_new\data_factor |
| timeseries | D:\Data_prepared_new\data_timeSeries |
```

**Sheet: sub_folder**
```
| data_type | folder_type | folder_name | MPON | RON |
|-----------|-------------|-------------|------|-----|
| output_factor_exposure | factor | factor_exposure | 0 | 1 |
| input_factor_jy | factor | FactorRet | 0 | 1 |
...
```

---

### 2. 数据源优先级配置

**文件**: `config_project/data_source_priority_config.xlsx`

**Sheet: factor**
```csv
data_type,source_name,rank
factor,jy,1
factor,wind,2
```

---

### 3. 时间工具配置

**文件**: `config_project/time_tools_config.xlsx`

**Sheet: time_zoon**
```
| zoom_name | start_time | end_time |
|-----------|------------|----------|
| morning | 08:00 | 12:00 |
| afternoon | 13:00 | 18:00 |
```

**Sheet: critical_time**
```
| zoom_name | critical_time |
|-----------|---------------|
| time_1 | 17:00 |
| time_2 | 16:00 |
| time_3 | 18:00 |
```

---

### 4. SQL 连接配置

**文件**: `config_project/sql_connection.yaml`

```yaml
database:
  host: localhost
  port: 3306
  user: your_username
  password: your_password
  database: data_prepared_new
```

---

## 三、输出数据格式

### 1. 因子暴露度

**文件**: `factorExposure_YYYYMMDD.csv`

```csv
valuation_date,code,size,beta,momentum,resvola,nlsize,btop,liquidity,earningsyield,growth,石油石化,...,综合
2024-01-01,000001.SZ,0.5,-0.2,0.3,0.1,0.4,-0.1,0.2,0.3,0.1,0,0,...,0
```

### 2. 因子收益率

**文件**: `factorReturn_YYYYMMDD.csv`

```csv
valuation_date,size,beta,momentum,resvola,nlsize,btop,liquidity,earningsyield,growth,石油石化,...,综合
2024-01-01,0.0012,-0.0005,0.0008,0.0003,0.0001,-0.0002,0.0004,0.0006,0.0002,0.0001,...,0.0000
```

### 3. 因子股票池

**文件**: `factorStockPool_YYYYMMDD.csv`

```csv
valuation_date,code
2024-01-01,000001.SZ
2024-01-01,000002.SZ
...
```

### 4. 因子协方差

**文件**: `factorCov_YYYYMMDD.csv`

```csv
valuation_date,factor_name,size,beta,...,综合
2024-01-01,size,0.0001,0.00005,...,0.00001
2024-01-01,beta,0.00005,0.0002,...,0.00002
...
```

### 5. 特异性风险

**文件**: `factorSpecificRisk_YYYYMMDD.csv`

```csv
valuation_date,code,specificrisk
2024-01-01,000001.SZ,0.023
2024-01-01,000002.SZ,0.018
...
```

### 6. 指数因子暴露度

**文件**: `{index}IndexExposure_YYYYMMDD.csv`

```csv
valuation_date,size,beta,...,综合,organization
2024-01-01,0.15,-0.08,...,0.02,hs300
```

---

## 四、数据库表结构

如果启用 SQL 写入 (`is_sql=True`)，需要以下数据库表：

| 表名 | 说明 |
|------|------|
| FactorExposrue | 因子暴露度 |
| FactorReturn | 因子收益率 |
| FactorPool | 因子股票池 |
| FactorCov | 因子协方差 |
| FactorSpecificrisk | 特异性风险 |
| FactorIndexExposure | 指数因子暴露度 |
| Indexygfactorexposure | 指数YG因子暴露度 |

详细表结构参见 `config_project/MySQL数据库表结构.md`

---

## 五、数据量估算

| 数据类型 | 每日数据量 | 说明 |
|----------|-----------|------|
| 因子暴露度 | ~5651 行 x 41 列 | 约 230K 数据点 |
| 因子收益率 | 1 行 x 40 列 | 40 数据点 |
| 股票池 | ~5651 行 x 2 列 | 约 11K 数据点 |
| 协方差矩阵 | 40 行 x 42 列 | 约 1.7K 数据点 |
| 特异性风险 | ~5651 行 x 3 列 | 约 17K 数据点 |
| 指数暴露度 | 7 指数 x 40 列 | 约 280 数据点 |

---

## 六、数据依赖关系

```
输入数据
├── .mat 文件 (因子数据源)
│   ├── factorexposure → 因子暴露度、股票池、指数暴露度
│   └── factorret → 因子收益率
├── 协方差 CSV → 因子协方差输出
├── 特异性风险 CSV → 特异性风险输出
├── 股票池 CSV → 股票代码映射
└── 指数成分股 CSV → 指数暴露度计算权重
```

---

*文档生成日期: 2026-01-25*
